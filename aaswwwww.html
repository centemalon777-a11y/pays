<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LearnHub â€” Student Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body { font-family:'Poppins',sans-serif; margin:0; padding:0; background: linear-gradient(135deg,#0ea5e9,#1e293b); color:#fff; }
header { display:flex; justify-content:space-between; align-items:center; padding:15px 20px; background:rgba(0,0,0,0.4); }
header h1 { font-size:1.8rem; color:#38bdf8; }
header button { padding:8px 12px; border:none; border-radius:8px; background:#ef4444; color:#fff; cursor:pointer; }
nav { display:flex; justify-content:center; background:rgba(0,0,0,0.3); }
nav button { background:transparent; border:none; color:#fff; padding:12px 20px; cursor:pointer; font-weight:600; transition:0.3s; }
nav button.active, nav button:hover { background:rgba(0,0,0,0.5); border-radius:8px; }
.container { max-width:1100px; margin:20px auto; padding:0 15px; }
.section { display:none; }
.section.active { display:block; }
.card { background:rgba(0,0,0,0.25); padding:20px; border-radius:12px; margin-bottom:20px; }
.register-btn { padding:6px 12px; background:#0ea5e9; border:none; border-radius:6px; cursor:pointer; color:#fff; }
.register-btn.registered { background:#22c55e; cursor:default; }
.messages, .forum-list, .leaderboard-list, .event-list { max-height:300px; overflow:auto; margin-top:10px; border-radius:8px; background:rgba(0,0,0,0.15); padding:10px; }
.msg { padding:8px; border-radius:8px; margin-bottom:6px; max-width:80%; }
.msg.admin { background:#0ea5e9; }
.msg.student { background:#22c55e; float:right; }
.input-area{display:flex;gap:10px;margin-top:10px;}
.input-area input{flex:1;padding:10px;border-radius:8px;border:none;}
.input-area button{padding:10px 15px;border:none;border-radius:8px;background:#0ea5e9;color:#fff;cursor:pointer;}
.input-area button:hover{background:#38bdf8;}
</style>
</head>
<body>

<header>
  <h1>Welcome, <span id="displayName">Student</span></h1>
  <button id="logoutBtn">Logout</button>
</header>

<nav>
  <button class="nav-btn active" data-section="messagesSection">Messages</button>
  <button class="nav-btn" data-section="eventsSection">Events</button>
  <button class="nav-btn" data-section="leaderboardSection">Leaderboard</button>
  <button class="nav-btn" data-section="forumSection">Forum</button>
</nav>

<div class="container">
  <!-- Messages -->
  <div class="section active" id="messagesSection">
    <div class="card">
      <h2>Messages from Admin</h2>
      <div class="messages" id="chatMessages"></div>
    </div>
  </div>

  <!-- Events -->
  <div class="section" id="eventsSection">
    <div class="card">
      <h2>Upcoming Tests & Registration</h2>
      <div class="event-list" id="eventList"></div>
    </div>
  </div>

  <!-- Leaderboard -->
  <div class="section" id="leaderboardSection">
    <div class="card">
      <h2>Leaderboard</h2>
      <div class="leaderboard-list" id="leaderboardList"></div>
    </div>
  </div>

  <!-- Forum -->
  <div class="section" id="forumSection">
    <div class="card">
      <h2>Discussion Forum</h2>
      <div class="forum-list" id="forumList"></div>
      <div class="input-area">
        <input type="text" id="postInput" placeholder="Write a question...">
        <button id="postBtn">Post</button>
      </div>
    </div>
  </div>
</div>

<script>
// ===== Current User =====
const currentUser = localStorage.getItem('currentUser');
if(!currentUser) window.location.href = 'login.html';
const displayName = JSON.parse(localStorage.getItem('user_' + currentUser))?.name || currentUser;
document.getElementById('displayName').textContent = displayName;

// ===== Logout =====
document.getElementById('logoutBtn').addEventListener('click', ()=>{
  localStorage.removeItem('currentUser');
  window.location.href='login.html';
});

// ===== Navigation =====
const navButtons = document.querySelectorAll('.nav-btn');
const sections = document.querySelectorAll('.section');
navButtons.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    navButtons.forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    sections.forEach(sec=>sec.classList.remove('active'));
    document.getElementById(btn.dataset.section).classList.add('active');
  });
});

// ===== Events Section =====
let events = JSON.parse(localStorage.getItem('events')) || [
  {id:1, title:"Math Test", date:"2025-10-05", registered:[]},
  {id:2, title:"Science Test", date:"2025-10-12", registered:[]}
];
const eventListEl = document.getElementById('eventList');
function renderEvents(){
  eventListEl.innerHTML='';
  events.forEach(ev=>{
    const div = document.createElement('div');
    div.className = 'event-card card';
    const isRegistered = ev.registered.includes(currentUser);

    // Messages per student per event
    const messagesKey = 'messages_' + currentUser;
    const allMessages = JSON.parse(localStorage.getItem(messagesKey) || '[]');
    const eventMessages = allMessages.filter(m => m.eventId === ev.id);
    const messagesHTML = eventMessages.length ? eventMessages.map(m=>`<div class="msg admin">${m.text} <small>${new Date(m.ts).toLocaleString()}</small></div>`).join('') : '<p>No messages yet</p>';

    div.innerHTML = `<h3>${ev.title} - ${new Date(ev.date).toDateString()}</h3>
      <button class="register-btn ${isRegistered?'registered':''}" ${isRegistered?'disabled':''}>${isRegistered?'Registered':'Register'}</button>
      <div class="messages">${messagesHTML}</div>`;

    const btn = div.querySelector('button');
    btn.addEventListener('click', ()=>{
      if(!isRegistered){
        ev.registered.push(currentUser);
        localStorage.setItem('events', JSON.stringify(events));
        renderEvents();
      }
    });
    eventListEl.appendChild(div);
  });
}
renderEvents();

// ===== Messages from Admin =====
const chatMessages = document.getElementById('chatMessages');
function renderMessages(){
  const messages = JSON.parse(localStorage.getItem('messages_' + currentUser) || '[]');
  chatMessages.innerHTML='';
  messages.forEach(m=>{
    const div = document.createElement('div');
    div.classList.add('msg', m.from==='Admin'?'admin':'student');
    div.innerHTML=`${m.text} <small>${new Date(m.ts).toLocaleString()}</small>`;
    chatMessages.appendChild(div);
  });
}
renderMessages();

// ===== Leaderboard =====
const leaderboardListEl = document.getElementById('leaderboardList');
function renderLeaderboard(){
  const leaderboard = JSON.parse(localStorage.getItem('leaderboard') || '{}');
  if(!leaderboard[currentUser]) leaderboard[currentUser] = {name: displayName, score: 0};
  leaderboardListEl.innerHTML='';
  Object.values(leaderboard).sort((a,b)=>b.score-a.score).forEach(u=>{
    const div = document.createElement('div');
    div.style.padding='8px';
    div.style.borderBottom='1px solid rgba(255,255,255,0.1)';
    div.textContent = `${u.name} - ${u.score}`;
    leaderboardListEl.appendChild(div);
  });
}
renderLeaderboard();

// ===== Forum =====
const forumListEl = document.getElementById('forumList');
const postInput = document.getElementById('postInput');
const postBtn = document.getElementById('postBtn');
function renderForum(){
  const posts = JSON.parse(localStorage.getItem('forum_posts')||'[]');
  forumListEl.innerHTML='';
  posts.slice().reverse().forEach(p=>{
    const div = document.createElement('div');
    div.style.padding='8px';
    div.style.borderBottom='1px solid rgba(255,255,255,0.1)';
    div.innerHTML=`<strong>${p.author}</strong>: ${p.text} <small>${new Date(p.ts).toLocaleString()}</small>`;
    forumListEl.appendChild(div);
  });
}
renderForum();

postBtn.addEventListener('click', ()=>{
  const text = postInput.value.trim();
  if(!text) return;
  const posts = JSON.parse(localStorage.getItem('forum_posts')||'[]');
  posts.push({author: displayName, text, ts: Date.now()});
  localStorage.setItem('forum_posts', JSON.stringify(posts));
  postInput.value='';
  renderForum();
});
</script>

</body>
</html>
