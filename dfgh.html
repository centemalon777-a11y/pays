<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Student Dashboard - LearnHub</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body { font-family:'Poppins',sans-serif; background: linear-gradient(135deg,#0ea5e9,#1e293b); color:#fff; margin:0; padding:0; }
header { display:flex; justify-content:space-between; align-items:center; padding:15px 20px; background:rgba(0,0,0,0.4); }
header h1 { font-size:1.8rem; color:#38bdf8; }
header button { padding:8px 12px; border:none; border-radius:8px; background:#ef4444; color:#fff; cursor:pointer; }
.container { max-width:1100px; margin:20px auto; padding:0 15px; }
.card { background:rgba(0,0,0,0.25); padding:20px; border-radius:12px; margin-bottom:20px; }
.event-card { margin-bottom:15px; padding:15px; background:rgba(0,0,0,0.35); border-radius:10px; }
.event-card h3 { margin-bottom:10px; color:#0ea5e9; }
.register-btn { padding:6px 12px; background:#0ea5e9; border:none; border-radius:6px; cursor:pointer; color:#fff; }
.register-btn.registered { background:#22c55e; cursor:default; }
.messages { max-height:200px; overflow:auto; margin-top:10px; border-radius:8px; background:rgba(0,0,0,0.15); padding:10px; }
.msg { padding:8px; border-radius:8px; margin-bottom:6px; max-width:80%; }
.msg.admin { background:#0ea5e9; }
.msg.student { background:#22c55e; float:right; }
</style>
</head>
<body>

<header>
  <h1>Student Dashboard</h1>
  <button id="logoutBtn">Logout</button>
</header>

<div class="container" id="eventsContainer">
  <!-- Events will appear here -->
</div>

<script>
// ===== Current User =====
const currentUser = localStorage.getItem('currentUser');
if(!currentUser) window.location.href = 'login.html';

// ===== Logout =====
document.getElementById('logoutBtn').addEventListener('click', ()=>{
  localStorage.removeItem('currentUser');
  window.location.href='login.html';
});

// ===== Load Events =====
let events = JSON.parse(localStorage.getItem('events')) || [
  {id:1, title:"Math Test", date:"2025-10-05", registered:[]},
  {id:2, title:"Science Test", date:"2025-10-12", registered:[]}
];
const container = document.getElementById('eventsContainer');

function renderEvents(){
  container.innerHTML = '';
  events.forEach(ev=>{
    const div = document.createElement('div');
    div.className = 'card event-card';

    const isRegistered = ev.registered.includes(currentUser);

    // Messages for this student for this event
    const messagesKey = 'messages_' + currentUser;
    const allMessages = JSON.parse(localStorage.getItem(messagesKey) || '[]');
    const eventMessages = allMessages.filter(m => m.eventId === ev.id);

    const messagesHTML = eventMessages.length ? eventMessages.map(m=>`
      <div class="msg admin">${m.text} <small>${new Date(m.ts).toLocaleString()}</small></div>
    `).join('') : '<p>No messages from admin yet</p>';

    div.innerHTML = `
      <h3>${ev.title} - ${new Date(ev.date).toDateString()}</h3>
      <button class="register-btn ${isRegistered?'registered':''}" ${isRegistered?'disabled':''}>
        ${isRegistered?'Registered':'Register'}
      </button>
      <div class="messages">${messagesHTML}</div>
    `;

    // Register button
    const btn = div.querySelector('button');
    btn.addEventListener('click', ()=>{
      if(!ev.registered.includes(currentUser)){
        ev.registered.push(currentUser);
        localStorage.setItem('events', JSON.stringify(events));
        renderEvents();
      }
    });

    container.appendChild(div);
  });
}

renderEvents();
</script>

</body>
</html>
