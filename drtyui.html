<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Student Dashboard</title>
<style>
body{font-family:Poppins,sans-serif;background:#1e293b;color:#fff;padding:20px;}
button{padding:6px 12px;border:none;border-radius:6px;background:#0ea5e9;color:#fff;cursor:pointer;margin-top:5px;}
.card{background:rgba(0,0,0,0.3);padding:15px;border-radius:12px;margin-bottom:20px;}
.notification-badge{background:red;color:#fff;border-radius:50%;padding:2px 6px;margin-left:5px;font-size:0.8rem;}
</style>
</head>
<body>

<h1>Student Dashboard</h1>
<button id="logoutBtn">Logout</button>

<div class="card">
<h2>Upcoming Events</h2>
<div id="eventList"></div>
</div>

<div class="card">
<h2>Notifications <span id="notifBadge" class="notification-badge" style="display:none;">0</span></h2>
<div id="notificationsList"></div>
</div>

<script>
const currentUser = localStorage.getItem('currentUser') || 'student1';

// ===== Logout =====
document.getElementById('logoutBtn').addEventListener('click', ()=>{
  localStorage.removeItem('currentUser');
  window.location.href='login.html';
});

// ===== Render Events =====
function renderEvents(){
  const events = JSON.parse(localStorage.getItem('events')||'[]');
  const container = document.getElementById('eventList');
  container.innerHTML = '';
  let newCount = 0;
  events.forEach(ev=>{
    const registered = ev.registered.includes(currentUser);
    if(!registered) newCount++;
    const div = document.createElement('div');
    div.innerHTML = `<strong>${ev.title}</strong> - ${new Date(ev.date).toDateString()} 
      <button ${registered?'disabled':''}>${registered?'Registered':'Register'}</button>`;
    div.querySelector('button').addEventListener('click', ()=>{
      if(!ev.registered.includes(currentUser)){
        ev.registered.push(currentUser);
        localStorage.setItem('events', JSON.stringify(events));
        renderEvents();
        addNotification(`You registered for ${ev.title}`);
      }
    });
    container.appendChild(div);
  });
  const badge = document.getElementById('notifBadge');
  badge.style.display = newCount>0?'inline':'none';
  badge.textContent = newCount;
}
renderEvents();

// ===== Notifications =====
function addNotification(text){
  let notifications = JSON.parse(localStorage.getItem('notifications_' + currentUser)||'[]');
  notifications.push({text, ts: Date.now()});
  localStorage.setItem('notifications_' + currentUser, JSON.stringify(notifications));
  renderNotifications();
}

function renderNotifications(){
  let notifications = JSON.parse(localStorage.getItem('notifications_' + currentUser)||'[]');
  const list = document.getElementById('notificationsList');
  list.innerHTML = '';
  notifications.slice().reverse().forEach(n=>{
    const div = document.createElement('div');
    div.textContent = `${n.text} (${new Date(n.ts).toLocaleString()})`;
    list.appendChild(div);
  });
}
renderNotifications();
</script>
</body>
</html>
