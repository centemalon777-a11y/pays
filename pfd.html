<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Student Dashboard - LearnHub</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body { font-family:'Poppins',sans-serif; background: linear-gradient(135deg,#0ea5e9,#1e293b); color:#fff; margin:0; padding:0; }
header { display:flex; justify-content:space-between; align-items:center; padding:15px 20px; background:rgba(0,0,0,0.4);}
header h1 {font-size:1.8rem;color:#38bdf8;}
header button {padding:8px 12px; border:none; border-radius:8px; background:#22c55e; color:#fff; cursor:pointer;}
.container {max-width:1100px;margin:20px auto;padding:0 15px;}
.card {background:rgba(0,0,0,0.25);padding:20px;border-radius:12px;margin-bottom:20px;}
.event-list button {padding:8px 12px;background:#0ea5e9;color:#fff;border:none;border-radius:6px;cursor:pointer;}
.event-list button.registered {background:#22c55e;cursor:default;}
</style>
</head>
<body>

<header>
  <h1>Student Dashboard</h1>
  <button id="logoutBtn">Logout</button>
</header>

<div class="container">
  <div class="card">
    <h2>Upcoming Tests & Registration</h2>
    <div class="event-list" id="eventList"></div>
  </div>
</div>

<script>
// ===== Current User =====
const currentUser = localStorage.getItem('currentUser');
const displayName = JSON.parse(localStorage.getItem('user_' + currentUser))?.name || currentUser;

// ===== Logout =====
document.getElementById('logoutBtn').addEventListener('click', ()=>{
  localStorage.removeItem('currentUser');
  window.location.href='login.html';
});

// ===== Events =====
const events = JSON.parse(localStorage.getItem('events')) || [
  {id:1,title:"Math Test",date:"2025-09-30",registered:[]},
  {id:2,title:"Science Test",date:"2025-10-05",registered:[]}
];

function renderEvents(){
  const eventListEl = document.getElementById('eventList');
  eventListEl.innerHTML='';

  events.forEach(ev=>{
    const div = document.createElement('div');
    div.style.marginBottom='10px';
    const registered = ev.registered.includes(displayName);
    div.innerHTML=`
      <strong>${ev.title}</strong> - ${new Date(ev.date).toDateString()} <br>
      <button class="${registered ? "registered" : ""}" ${registered?'disabled':''}>
        ${registered ? "Registered" : "Register"}
      </button>
    `;
    const btn = div.querySelector('button');
    btn.addEventListener('click', ()=>{
      if(!registered){
        // Add student to event
        ev.registered.push(displayName);
        localStorage.setItem('events', JSON.stringify(events));

        // Notify admin
        const adminMessages = JSON.parse(localStorage.getItem('admin_event_messages') || '[]');
        adminMessages.push({
          eventId: ev.id,
          eventTitle: ev.title,
          student: displayName,
          timestamp: Date.now()
        });
        localStorage.setItem('admin_event_messages', JSON.stringify(adminMessages));

        renderEvents();
      }
    });
    eventListEl.appendChild(div);
  });
}

renderEvents();
</script>

</body>
</html>
